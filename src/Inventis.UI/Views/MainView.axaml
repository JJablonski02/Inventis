<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             xmlns:controls="using:Inventis.UI.Controls"
             xmlns:converter="using:Inventis.UI.Converters"
             xmlns:vm="using:Inventis.UI.ViewModels"
             x:DataType="vm:MainViewModel"
             x:Class="Inventis.UI.Views.MainView">
<UserControl.Resources>
        <converter:TopBarTemplateConverter x:Key="TopBarTemplateConverter">
            <converter:TopBarTemplateConverter.TopBarTemplateLoggedIn>
                <DataTemplate>
                    <Grid Margin="20" ColumnDefinitions="Auto, *, Auto">
                        <StackPanel Grid.Column="0" VerticalAlignment="Center" Orientation="Horizontal">
                            <Image
                                Height="50"
                                Source="avares://Inventis.UI/Assets/inventis.png"
                                Margin="0 0 20 0"/>
                            <TextBlock
                                Text=" | "
                                VerticalAlignment="Center"
                                Foreground="{DynamicResource White}"/>
                            <TextBlock
                                TextWrapping="Wrap"
                                TextTrimming="CharacterEllipsis"
                                VerticalAlignment="Center"
                                Foreground="{DynamicResource White}"/>
                        </StackPanel>

                        <Grid ColumnDefinitions="Auto, Auto" Grid.Column="2" HorizontalAlignment="Right">
                            <controls:WindowButton Variant="Minify" Margin="0 0 5 0"
                                                   Grid.Column="0"
                                                   CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                                                   />
                            <controls:WindowButton Variant="Close" Margin="5 0 0 0"
                                                   Grid.Column="1"
                                                   CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                                                   />
                        </Grid>
                    </Grid>
                </DataTemplate>
            </converter:TopBarTemplateConverter.TopBarTemplateLoggedIn>
            <converter:TopBarTemplateConverter.TopBarTemplateLoggedOut>
                <DataTemplate>
                    <Grid HorizontalAlignment="Stretch" VerticalAlignment="Center" Margin="20">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" HorizontalAlignment="Left" Width="70"/>
                        <Image
                            Grid.Column="1"
                            Height="50"
                            Source="avares://Inventis.UI/Assets/Inventis.png"
                            Margin="0 0 20 0"/>
                        <StackPanel Grid.Column="2" HorizontalAlignment="Right" Orientation="Horizontal">
                            <controls:WindowButton Variant="Minify" Margin="0 0 5 0"
                                                   CommandParameter="{Binding RelativeSource={RelativeSource Self}}"/>
                            <controls:WindowButton Variant="Close" Margin="5 0 0 0"
                                                   CommandParameter="{Binding RelativeSource={RelativeSource Self}}"/>
                        </StackPanel>
                    </Grid>
                </DataTemplate>
            </converter:TopBarTemplateConverter.TopBarTemplateLoggedOut>
        </converter:TopBarTemplateConverter>
    </UserControl.Resources>


    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!--Header-->
        <ContentControl Grid.Row="0"
                         Name="HeaderParent"
                         Content="{Binding TitleBar}"
                         Background="{DynamicResource Background-Dark}"
                         ContentTemplate="{Binding TitleBar.IsLoggedIn, Converter={StaticResource TopBarTemplateConverter}}"
                         PointerPressed="Grid_OnPointerPressed" PointerReleased="Grid_OnPointerReleased" PointerMoved="Grid_OnPointerMoved"
                        />

        <!-- Main content -->
        <ContentControl
            Grid.Row="1"
            Background="{DynamicResource Background}"
            Content="{Binding Content}"
            IsEnabled="True"/>
        <StackPanel
            Grid.Row="2"
            IsVisible="{Binding UiState.IsBusy}"
            VerticalAlignment="Bottom"
            HorizontalAlignment="Right"
            Height="30">
        </StackPanel>
    </Grid>
</UserControl>
